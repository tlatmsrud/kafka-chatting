<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>채팅방</title>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script>

        const nickname = localStorage.getItem("nickname");
        const roomId = [[${roomId}]]

        $(document).ready(function(){
            setInterval(function(){
                $.ajax({
                    cache : false,
                    url : "/polling/"+roomId,
                    success:function(data){
                        let table = $("#chattingTable");
                        table.empty();

                        for(let i in data){
                            let message = data[i].message;
                            let time = data[i].time;
                            let sendNickname = data[i].nickname;

                            let row = $("<tr />").append(
                                $("<td />").text(sendNickname),
                                $("<td />").text(message  + " " +  time)
                            );
                            table.append(row);
                        }

                    }

                })
            },1000)
        });

        function sendMessage(){

            const data = {
                "message" : document.getElementById('message').value
                ,"roomId" : roomId
                ,"nickname" : nickname
            }
            $.ajax({
                url: "/polling/send",
                type:'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function(){
                    console.log('Message sent :', data.message)
                },
                error: function(error){
                    alert("Error: "+ error);
                }
            })
        }

    </script>
</head>
<body>
<div>
    <h1 th:text="${roomName}"></h1><h1> 채팅방</h1>
</div>

<table id = "chattingTable">

</table>
<div>
    <input type="text" id="message"/>
    <input type="button" onclick="sendMessage()" value = "전송"/>
</div>
</body>
</html>